<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Interactivo de √Åreas Protegidas del Ecuador</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-color: #2c5e1a;
            --secondary-color: #4a8c2c;
            --fias-color: #0d6efd;
            --light-bg: #f8f9fa;
            --admin-color: #6f42c1;
            --rem-color: #20c997;
            --fap-color: #fd7e14;
            --bio-color: #e83e8c;
            --pasf-color: #ffc107;
            --conserva-color: #17a2b8;
            --feig-color: #6610f2;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 0.8rem 1rem;
        }

        .navbar-brand {
            font-weight: 700;
        }

        #map-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #sidebar {
            width: 400px;
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
            display: flex;
            flex-direction: column;
            box-shadow: 3px 0 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            z-index: 1001;
            border-right: 1px solid #eaeaea;
        }
        
        #sidebar.collapsed {
            transform: translateX(-400px);
        }

        .sidebar-header {
            padding: 1.2rem;
            border-bottom: 1px solid #e0e0e0;
            background-color: white;
        }
        
        #search-input {
            border-radius: 50px;
            padding: 0.6rem 1.2rem;
            border: 1px solid #ced4da;
            transition: all 0.3s;
        }

        #search-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(44, 94, 26, 0.25);
            border-color: var(--primary-color);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
        }

        .nav-pills .nav-link {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            margin: 0 0.2rem;
            transition: all 0.2s;
        }

        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            box-shadow: 0 2px 6px rgba(44, 94, 26, 0.3);
        }

        .filter-section {
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            margin: 0.5rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .filter-group {
            margin-bottom: 1rem;
        }

        .filter-group:last-child {
            margin-bottom: 0;
        }

        .filter-group h6 {
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .filter-group h6 .badge {
            font-size: 0.7rem;
        }

        .filter-options {
            max-height: 200px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.4rem 0.6rem;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .filter-option:hover {
            background-color: #f8f9fa;
        }

        .filter-option input {
            margin-right: 0.6rem;
            cursor: pointer;
        }

        .filter-option label {
            flex: 1;
            margin-bottom: 0;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .filter-option .count {
            font-size: 0.8rem;
            color: #6c757d;
            background-color: #f8f9fa;
            padding: 0.15rem 0.5rem;
            border-radius: 10px;
        }

        .filter-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .filter-actions button {
            flex: 1;
            padding: 0.3rem 0.5rem;
            font-size: 0.8rem;
        }

        .area-card {
            border: 1px solid rgba(0,0,0,.125);
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            cursor: pointer;
            background-color: white;
            overflow: hidden;
        }

        .area-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .area-card.active {
            border-left: 5px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(44, 94, 26, 0.2);
            background-color: #fcfdfc;
        }

        .admin-card.active {
            border-left: 5px solid var(--admin-color);
        }

        .admin-card {
            border-left: 5px solid var(--admin-color);
        }

        .area-card-header {
            padding: 0.9rem 1.2rem;
            background: linear-gradient(to right, rgba(0,0,0,.02), rgba(0,0,0,.05));
            border-bottom: 1px solid rgba(0,0,0,.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .area-card-body {
            padding: 1.2rem;
        }

        .area-card-icon {
            font-size: 1.6rem;
            margin-right: 0.7rem;
            width: 35px;
            text-align: center;
        }

        .fias-badge {
            background: linear-gradient(135deg, var(--fias-color) 0%, #0a58ca 100%);
            box-shadow: 0 2px 5px rgba(13, 110, 253, 0.3);
        }

        .admin-badge {
            background: linear-gradient(135deg, var(--admin-color) 0%, #5a32a3 100%);
            color: white;
        }

        .stats-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.2rem;
            background: linear-gradient(to right, #f8f9fa, #e9ecef);
            border-top: 1px solid #e9ecef;
        }

        #map-wrapper {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }

        #toggle-sidebar-btn {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1002;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.3s;
        }

        #toggle-sidebar-btn:hover {
            transform: scale(1.1);
        }
        
        .leaflet-popup-content-wrapper {
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .leaflet-popup-content {
            margin: 15px;
            line-height: 1.5;
        }

        .leaflet-popup-content h5 {
            color: var(--primary-color);
            margin-bottom: 0.7rem;
            border-bottom: 2px solid #eee;
            padding-bottom: 0.7rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .leaflet-popup-content h5 i {
            margin-right: 10px;
            font-size: 1.2em;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(13, 110, 253, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(13, 110, 253, 0); }
            100% { box-shadow: 0 0 0 0 rgba(13, 110, 253, 0); }
        }

        .fias-marker-pulse {
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        #loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            backdrop-filter: blur(5px);
        }

        .loading-text {
            margin-top: 20px;
            font-weight: 500;
            color: var(--primary-color);
        }

        .legend {
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            line-height: 1.5;
        }

        .legend h4 {
            margin: 0 0 10px;
            font-size: 1rem;
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }

        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
            border-radius: 50%;
        }

        .legend span {
            font-size: 0.9rem;
            line-height: 18px;
        }

        .custom-btn {
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        .custom-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        /* Estilos espec√≠ficos para √°reas administrativas */
        .fiass-color { color: var(--fias-color); }
        .rem-color { color: var(--rem-color); }
        .fap-color { color: var(--fap-color); }
        .bio-color { color: var(--bio-color); }
        .pasf-color { color: var(--pasf-color); }
        .conserva-color { color: var(--conserva-color); }
        .feig-color { color: var(--feig-color); }

        /* Mejoras de scrollbar */
        .sidebar-content::-webkit-scrollbar,
        .filter-options::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar-content::-webkit-scrollbar-track,
        .filter-options::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .sidebar-content::-webkit-scrollbar-thumb,
        .filter-options::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }

        .sidebar-content::-webkit-scrollbar-thumb:hover,
        .filter-options::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
               <img src="https://fias.org.ec/wp-content/uploads/2021/11/Logo_FIAS_web.png" height="30" width="150" alt="Logo de FIAS" loading="lazy">                
<span class="fs-4 fw-bold">MAPA INTERACTIVO DE BIENES INSTITUCIONALES FIAS </span>
            </a>
            <div class="d-flex align-items-center ms-auto">
                <button class="btn btn-sm btn-outline-light me-2 custom-btn" data-bs-toggle="tooltip" title="Reiniciar todos los filtros" id="reset-filters">
                    <i class="fas fa-filter-circle-xmark me-1"></i> Reiniciar
                </button>
                <div class="form-check form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="fias-filter">
                    <label class="form-check-label text-white small ms-1" for="fias-filter">
                        <i class="fas fa-gem me-1"></i> Solo FIAS
                    </label>
                </div>
            </div>
        </div>
    </nav>

    <div id="map-container">
        <div id="sidebar">
            <div class="sidebar-header">
                <input type="text" id="search-input" class="form-control" placeholder="üîé Buscar por nombre...">
            </div>
            
            <ul class="nav nav-pills p-3" id="filter-tabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="type-tab" data-bs-toggle="pill" data-bs-target="#type-panel" type="button" role="tab">
                        <i class="fas fa-tag me-1"></i> Tipo
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="region-tab" data-bs-toggle="pill" data-bs-target="#region-panel" type="button" role="tab">
                        <i class="fas fa-globe-americas me-1"></i> Regi√≥n
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="admin-tab" data-bs-toggle="pill" data-bs-target="#admin-panel" type="button" role="tab">
                        <i class="fas fa-building me-1"></i> Administrativas
                    </button>
                </li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane fade show active" id="type-panel" role="tabpanel">
                    <div class="filter-section">
                        <div class="filter-group">
                            <h6>
                                <span>Tipos de √Åreas</span>
                                <span class="badge bg-primary" id="selected-types-count">0</span>
                            </h6>
                            <div class="filter-options" id="type-options"></div>
                            <div class="filter-actions">
                                <button class="btn btn-sm btn-outline-primary" id="select-all-types">Seleccionar todos</button>
                                <button class="btn btn-sm btn-outline-secondary" id="clear-all-types">Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="region-panel" role="tabpanel">
                    <div class="filter-section">
                        <div class="filter-group">
                            <h6>
                                <span>Regiones</span>
                                <span class="badge bg-primary" id="selected-regions-count">0</span>
                            </h6>
                            <div class="filter-options" id="region-options"></div>
                            <div class="filter-actions">
                                <button class="btn btn-sm btn-outline-primary" id="select-all-regions">Seleccionar todos</button>
                                <button class="btn btn-sm btn-outline-secondary" id="clear-all-regions">Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-pane fade" id="admin-panel" role="tabpanel">
                    <div class="filter-section">
                        <div class="filter-group">
                            <h6>
                                <span>√Åreas Administrativas</span>
                                <span class="badge bg-primary" id="selected-admin-count">0</span>
                            </h6>
                            <div class="filter-options" id="admin-options"></div>
                            <div class="filter-actions">
                                <button class="btn btn-sm btn-outline-primary" id="select-all-admin">Seleccionar todos</button>
                                <button class="btn btn-sm btn-outline-secondary" id="clear-all-admin">Limpiar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-content">
                <div class="p-2">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="text-success mb-0"><i class="fas fa-list me-1"></i> √Åreas Encontradas</h6>
                        <span class="badge bg-secondary rounded-pill" id="areas-count">0/0</span>
                    </div>
                    <div id="areas-cards"></div>
                </div>
            </div>
            
            <div class="stats-container">
                <small class="text-muted">
                    Mostrando <strong id="visible-count">0</strong> de <strong id="total-count">0</strong> √°reas
                </small>
                <button class="btn btn-sm btn-outline-secondary rounded-circle" id="scroll-to-top" data-bs-toggle="tooltip" title="Volver al inicio">
                    <i class="fas fa-arrow-up"></i>
                </button>
            </div>
        </div>
        <div id="map-wrapper">
            <div id="loading-overlay">
                <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Cargando mapa...</span>
                </div>
                <span class="loading-text mt-3">Cargando mapa...</span>
            </div>
            <button id="toggle-sidebar-btn" class="btn btn-light shadow-sm"><i class="fas fa-bars"></i></button>
            <div id="map"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // **ACTUALIZACI√ìN**: Se a√±ade la propiedad "link" a todas las √°reas protegidas.
            const areasProtegidas = [
                {id: 1, nombre: "Parque Nacional Yasun√≠", tipo: "Parque Nacional", region: "Amazon√≠a", latitud: -1.5261, longitud: -76.4559, link: "https://sharepoint.fias.org.ec/inventario/YASUNI"},
                {id: 2, nombre: "Reserva Ecol√≥gica Cotacachi-Cayapas", tipo: "Reserva Ecol√≥gica", region: "Sierra", latitud: 0.681, longitud: -78.594, link: "URL_AQUI"},
                {id: 3, nombre: "Parque Nacional Gal√°pagos", tipo: "Parque Nacional", region: "Insular", latitud: -0.9538, longitud: -90.9656, link: "URL_AQUI"},
                {id: 4, nombre: "Parque Nacional Machalilla", tipo: "Parque Nacional", region: "Costa", latitud: -1.5427, longitud: -80.7512, link: "URL_AQUI"},
                {id: 5, nombre: "Reserva de Producci√≥n Faun√≠stica Cuyabeno", tipo: "Reserva de Producci√≥n de Fauna", region: "Amazon√≠a", latitud: -0.1807, longitud: -76.1507, link: "URL_AQUI"},
                {id: 6, nombre: "Parque Nacional Sangay", tipo: "Parque Nacional", region: "Sierra", latitud: -1.837, longitud: -78.3864, link: "URL_AQUI"},
                {id: 7, nombre: "Parque Nacional Cajas", tipo: "Parque Nacional", region: "Sierra", latitud: -2.8487368, longitud: -79.2537609, link: "URL_AQUI"},
                {id: 8, nombre: "Reserva Ecol√≥gica El √Ångel", tipo: "Reserva Ecol√≥gica", region: "Sierra", latitud: 0.7551564, longitud: -77.9053182, link: "URL_AQUI"},
                {id: 9, nombre: "Reserva Ecol√≥gica Mache-Chindul", tipo: "Reserva Ecol√≥gica", region: "Costa", latitud: 0.4802566, longitud: -79.7848422, link: "URL_AQUI"},
                {id: 10, nombre: "Reserva Ecol√≥gica Manglares Cayapas Mataje", tipo: "Reserva Ecol√≥gica", region: "Costa", latitud: 1.2839279, longitud: -78.9061921, link: "URL_AQUI"},
                {id: 11, nombre: "Refugio de Vida Silvestre La Chiquita", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: 1.2298436, longitud: -78.7647658, link: "URL_AQUI"},
                {id: 12, nombre: "Reserva Marina Galera San Francisco", tipo: "Reserva Marina", region: "Costa", latitud: 0.7572725, longitud: -80.0946498, link: "URL_AQUI"},
                {id: 13, nombre: "Refugio de Vida Silvestre Manglares Estuario R√≠o Esmeraldas", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: 0.9775963, longitud: -79.645929, link: "URL_AQUI"},
                {id: 14, nombre: "Refugio de Vida Silvestre El Pambilar", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: 0.6089452, longitud: -79.1648003, link: "URL_AQUI"},
                {id: 15, nombre: "Refugio de Vida Silvestre Isla Coraz√≥n y Fragata", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: -0.6503938, longitud: -80.3712221, link: "URL_AQUI"},
                {id: 16, nombre: "Refugio de Vida Silvestre Marino Costera Pacoche", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: -1.0688227, longitud: -80.886806, link: "URL_AQUI"},
                {id: 17, nombre: "Reserva Marina El Pelado", tipo: "Reserva Marina", region: "Costa", latitud: -1.9432125, longitud: -80.7879407, link: "URL_AQUI"},
                {id: 18, nombre: "Reserva Puntilla De Santa Elena", tipo: "Reserva de Producci√≥n de Fauna", region: "Costa", latitud: -2.1887133, longitud: -81.0110023, link: "URL_AQUI"},
                {id: 19, nombre: "√Årea Nacional De Recreaci√≥n Playas Villamil", tipo: "√Årea Nacional de Recreaci√≥n", region: "Costa", latitud: -2.6423745, longitud: -80.3886322, link: "URL_AQUI"},
                {id: 20, nombre: "Parque Lago de Chong√≥n", tipo: "√Årea Nacional de Recreaci√≥n", region: "Costa", latitud: -2.2242155, longitud: -80.0966835, link: "URL_AQUI"},
                {id: 21, nombre: "Reserva de Producci√≥n de Fauna Manglares El Salado", tipo: "Reserva de Producci√≥n de Fauna", region: "Costa", latitud: -2.2578119, longitud: -79.9484319, link: "URL_AQUI"},
                {id: 22, nombre: "√Årea Nacional de Recreaci√≥n Isla Santay", tipo: "√Årea Nacional de Recreaci√≥n", region: "Costa", latitud: -2.2237935, longitud: -79.874174, link: "URL_AQUI"},
                {id: 23, nombre: "Reserva Ecol√≥gica Manglares Churute", tipo: "Reserva Ecol√≥gica", region: "Costa", latitud: -2.4195775, longitud: -79.6246449, link: "URL_AQUI"},
                {id: 24, nombre: "Refugio de Vida Silvestre Manglares el Morro", tipo: "Refugio de Vida Silvestre", region: "Costa", latitud: -2.6245454, longitud: -80.2450472, link: "URL_AQUI"},
                {id: 25, nombre: "Reserva Marina Isla Santa Clara", tipo: "Reserva Marina", region: "Costa", latitud: -3.1665538, longitud: -80.4333558, link: "URL_AQUI"},
                {id: 26, nombre: "Reserva Ecol√≥gica de Arenillas", tipo: "Reserva Ecol√≥gica", region: "Costa", latitud: -3.5665416, longitud: -80.1429895, link: "URL_AQUI"},
                {id: 27, nombre: "Reserva Ecol√≥gica Antisana", tipo: "Reserva Ecol√≥gica", region: "Sierra", latitud: -0.5516115, longitud: -78.1564432, link: "URL_AQUI"},
                {id: 28, nombre: "Parque Nacional Cayambe-Coca", tipo: "Parque Nacional", region: "Sierra", latitud: -0.0730003, longitud: -77.8367282, link: "URL_AQUI"},
                {id: 29, nombre: "Refugio de Vida Silvestre Pasochoa", tipo: "Refugio de Vida Silvestre", region: "Sierra", latitud: -0.4596148, longitud: -78.4524591, link: "URL_AQUI"},
                {id: 30, nombre: "Reserva Ecol√≥gica Los Illinizas", tipo: "Reserva Ecol√≥gica", region: "Sierra", latitud: -0.7022491, longitud: -79.0645695, link: "URL_AQUI"},
                {id: 31, nombre: "Parque Nacional Cotopaxi", tipo: "Parque Nacional", region: "Sierra", latitud: -0.7007416, longitud: -78.4297187, link: "URL_AQUI"},
                {id: 32, nombre: "Area Nacional de Recreaci√≥n El Boliche", tipo: "√Årea Nacional de Recreaci√≥n", region: "Sierra", latitud: -0.794213, longitud: -78.5433701, link: "URL_AQUI"},
                {id: 33, nombre: "Reserva Biol√≥gica Colonso Chalupas", tipo: "Reserva Biol√≥gica", region: "Amazon√≠a", latitud: -0.9889268, longitud: -77.9078127, link: "URL_AQUI"},
                {id: 34, nombre: "Parque Nacional Llanganates", tipo: "Parque Nacional", region: "Sierra", latitud: -1.1491018, longitud: -78.2476146, link: "URL_AQUI"},
                {id: 35, nombre: "Reserva de Producci√≥n de Fauna Chimborazo", tipo: "Reserva de Producci√≥n de Fauna", region: "Sierra", latitud: -1.4693018, longitud: -78.8169396, link: "URL_AQUI"},
                {id: 36, nombre: "√Årea Nacional de Recreaci√≥n Quimsacocha", tipo: "√Årea Nacional de Recreaci√≥n", region: "Sierra", latitud: -2.9942882, longitud: -79.2366048, link: "URL_AQUI"},
                {id: 37, nombre: "Parque Nacional Podocarpus", tipo: "Parque Nacional", region: "Sierra", latitud: -4.1260477, longitud: -78.9950463, link: "URL_AQUI"},
                {id: 38, nombre: "Parque Nacional de Yacuri", tipo: "Parque Nacional", region: "Sierra", latitud: -4.6257708, longitud: -79.3127543, link: "URL_AQUI"},
                {id: 39, nombre: "Reserva Ecol√≥gica Cof√°n-Bermejo", tipo: "Reserva Ecol√≥gica", region: "Amazon√≠a", latitud: 0.3640394, longitud: -77.4126177, link: "URL_AQUI"},
                {id: 40, nombre: "Parque Nacional Sumaco Napo-Galeras", tipo: "Parque Nacional", region: "Amazon√≠a", latitud: -0.3659083, longitud: -77.4701972, link: "URL_AQUI"},
                {id: 41, nombre: "Reserva Biol√≥gica Limoncocha", tipo: "Reserva Biol√≥gica", region: "Amazon√≠a", latitud: -0.3967244, longitud: -76.6123884, link: "URL_AQUI"},
                {id: 42, nombre: "Reserva Biol√≥gica El C√≥ndor", tipo: "Reserva Biol√≥gica", region: "Amazon√≠a", latitud: -3.4375542, longitud: -78.2074508, link: "URL_AQUI"},
                {id: 43, nombre: "Reserva Biol√≥gica El Quimi", tipo: "Reserva Biol√≥gica", region: "Amazon√≠a", latitud: -3.4385812, longitud: -78.4093123, link: "URL_AQUI"},
                {id: 44, nombre: "Refugio de Vida Silvestre El Zarza", tipo: "Refugio de Vida Silvestre", region: "Amazon√≠a", latitud: -3.8235978, longitud: -78.7569332, link: "URL_AQUI"},
                {id: 45, nombre: "Reserva Biol√≥gica Cerro Plateado", tipo: "Reserva Biol√≥gica", region: "Amazon√≠a", latitud: -4.6041852, longitud: -78.7368989, link: "URL_AQUI"},
                {id: 46, nombre: "√Årea Ecol√≥gica de Conservaci√≥n Municipal Siete Iglesias", tipo: "√Årea Ecol√≥gica de Conservaci√≥n", region: "Amazon√≠a", latitud: -3.101546, longitud: -78.6120758, link: "URL_AQUI"},
                {id: 47, nombre: "√Årea Ecol√≥gico de Conservaci√≥n Municipal Taita Imbabura", tipo: "√Årea Ecol√≥gica de Conservaci√≥n", region: "Sierra", latitud: 0.2734667, longitud: -78.1290715, link: "URL_AQUI"},
                {id: 48, nombre: "√Årea Ecol√≥gica de Conservaci√≥n Municipal La Bonita Cofanes/Chingual", tipo: "√Årea Ecol√≥gica de Conservaci√≥n", region: "Amazon√≠a", latitud: 0.4734698, longitud: -77.5442678, link: "URL_AQUI"},
                {id: 49, nombre: "√Årea nacional de recreaci√≥n Parque Samanes", tipo: "√Årea Nacional de Recreaci√≥n", region: "Costa", latitud: -2.1035904, longitud: -79.896413, link: "URL_AQUI"},
                {id: 50, nombre: "Reserva Geobot√°nica Pululahua", tipo: "Reserva Geobot√°nica", region: "Sierra", latitud: 0.038, longitud: -78.463, link: "URL_AQUI"},
                {id: 51, nombre: "Cordillera Oriental del Carchi", tipo: "√Årea Ecol√≥gica de Conservaci√≥n", region: "Sierra", latitud: 0.5335199, longitud: -77.8011826, link: "URL_AQUI"},
                {id: 52, nombre: "Reserva Marina Gal√°pagos", tipo: "Reserva Marina", region: "Insular", latitud: -0.8061698, longitud: -90.5477817, link: "URL_AQUI"},
                {id: 53, nombre: "√Årea Protegida Privada Ichubamba Yasepan", tipo: "√Årea Protegida Privada", region: "Sierra", latitud: -2.0855835, longitud: -78.4940793, link: "URL_AQUI"},
                {id: 54, nombre: "Bosque La Perla", tipo: "Bosque Protector", region: "Costa", latitud: -0.1564607, longitud: -79.2828232, link: "URL_AQUI"},
                {id: 55, nombre: "√Årea Ecolog√≠ca de Conservaci√≥n Municipal Curiquingue Gallocantana", tipo: "√Årea Ecol√≥gica de Conservaci√≥n", region: "Sierra", latitud: -2.7574528, longitud: -79.1834216, link: "URL_AQUI"},
                {id: 56, nombre: "Refugio de vida silvestre Mach√°ngara Tomebamba", tipo: "Refugio de Vida Silvestre", region: "Sierra", latitud: -2.7331373, longitud: -79.0614996, link: "URL_AQUI"}
            ];
            
            // Lista de √°reas con bienes FIAS
            const fiasAreasNames = [
                "Reserva Ecol√≥gica El √Ångel", "Parque Nacional Sangay", "Reserva de Producci√≥n de Fauna Chimborazo", 
                "Parque Nacional Cotopaxi", "Area Nacional de Recreaci√≥n El Boliche", "Reserva Ecol√≥gica Los Illinizas", 
                "Reserva Ecol√≥gica Cotacachi-Cayapas", "Parque Nacional Podocarpus", "Refugio de Vida Silvestre El Zarza", 
                "Parque Nacional de Yacuri", "Reserva Biol√≥gica Cerro Plateado", "Parque Nacional Cayambe-Coca", 
                "Reserva Geobot√°nica Pululahua", "Refugio de Vida Silvestre Pasochoa", "Parque Nacional Llanganates", 
                "Reserva Biol√≥gica Colonso Chalupas", "Reserva Marina El Pelado", "Reserva Puntilla De Santa Elena", 
                "Parque Nacional Machalilla", "Refugio de Vida Silvestre Marino Costera Pacoche", 
                "Refugio de Vida Silvestre Isla Coraz√≥n y Fragata", "Reserva Ecol√≥gica Manglares Churute", 
                "Parque Lago de Chong√≥n", "Reserva de Producci√≥n de Fauna Manglares El Salado", 
                "√Årea Nacional de Recreaci√≥n Isla Santay", "Refugio de Vida Silvestre Manglares el Morro", 
                "√Årea Nacional De Recreaci√≥n Playas Villamil", "Reserva Ecol√≥gica Manglares Cayapas Mataje", 
                "Refugio de Vida Silvestre La Chiquita", "Reserva Ecol√≥gica Mache-Chindul", 
                "Refugio de Vida Silvestre Manglares Estuario R√≠o Esmeraldas", "Refugio de Vida Silvestre El Pambilar", 
                "Reserva Marina Galera San Francisco", "Reserva Marina Isla Santa Clara", 
                "Reserva Ecol√≥gica de Arenillas", "Reserva Ecol√≥gica Antisana", "Parque Nacional Sumaco Napo-Galeras", 
                "Parque Nacional Yasun√≠", "Reserva Biol√≥gica Limoncocha", "Reserva de Producci√≥n Faun√≠stica Cuyabeno", 
                "Reserva Ecol√≥gica Cof√°n-Bermejo"
            ];

            // Asigna la propiedad tieneBienesFIAS a cada √°rea protegida que corresponda
            areasProtegidas.forEach(area => {
                area.tieneBienesFIAS = fiasAreasNames.includes(area.nombre);
            });
	            
            // Configuraci√≥n de iconos para cada tipo de √°rea
            const areaConfig = {
                'Parque Nacional': { icon: 'fa-mountain-sun', color: '#2ecc71' },
                'Reserva Biol√≥gica': { icon: 'fa-dna', color: '#3498db' },
                'Reserva Geobot√°nica': { icon: 'fa-seedling', color: '#9b59b6' },
                'Reserva Ecol√≥gica': { icon: 'fa-leaf', color: '#e74c3c' },
                'Reserva Marina': { icon: 'fa-water', color: '#1abc9c' },
                '√Årea Nacional de Recreaci√≥n': { icon: 'fa-person-hiking', color: '#f1c40f' },
                'Reserva de Producci√≥n de Fauna': { icon: 'fa-paw', color: '#e67e22' },
                'Refugio de Vida Silvestre': { icon: 'fa-dove', color: '#e84393' },
                '√Årea Ecol√≥gica de Conservaci√≥n': { icon: 'fa-shield-halved', color: '#7f8c8d' },
                'Bosque Protector': { icon: 'fa-tree', color: '#27ae60' },
                '√Årea Protegida Privada': { icon: 'fa-lock', color: '#8e44ad' },
                'default': { icon: 'fa-map-marker-alt', color: '#95a5a6' }
            };
            
            // Agregar √°reas administrativas
            const areasAdministrativas = [
                {
                    id: 100, nombre: "FIAS Institucional", tipo: "√Årea Administrativa", subtipo: "FIAS", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://fiasec-my.sharepoint.com/:x:/g/personal/jcruzg_fias_org_ec/ET7cHBq4_bBBhZHTCjfVxdIBGImPaOuGN7m4RpZm5Egrag",
                },
                {
                    id: 101, nombre: "REM (REDD Early Movers)", tipo: "√Årea Administrativa", subtipo: "REM", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/REM"
                },
                {
                    id: 102, nombre: "FAP (Fondo de √Åreas Protegidas)", tipo: "√Årea Administrativa", subtipo: "FAP", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/FAP"
                },
                {
                    id: 103, nombre: "Bioeconom√≠a", tipo: "√Årea Administrativa", subtipo: "Bioeconom√≠a", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/Bioeconomia"
                },
                {
                    id: 104, nombre: "PASF (Proyecto Amazonia Sin Fuego)", tipo: "√Årea Administrativa", subtipo: "PASF", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/PASF"
                },
                {
                    id: 105, nombre: "Conserva Aves", tipo: "√Årea Administrativa", subtipo: "Conserva Aves", region: "Sierra", latitud: -0.2149, longitud: -78.5009,
                    direccion: "Edificio Concorde, Av. 12 de Octubre y Francisco Salazar", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/ConservaAves"
                },
                {
                    id: 106, nombre: "FEIG (Fondo para Control de Especies Invasoras de Gal√°pagos)", tipo: "√Årea Administrativa", subtipo: "FEIG", region: "Gal√°pagos", latitud: -0.7456, longitud: -90.3018,
                    direccion: "Marchena 115 y Charles Darwin, Puerto Ayora", esAdministrativa: true,
                    link: "https://sharepoint.fias.org.ec/inventario/FEIG"
                }
            ];
            
            // Marcar todas las √°reas administrativas para que muestren el bot√≥n de inventario.
            areasAdministrativas.forEach(area => area.tieneBienesFIAS = true);

            // Combinar todas las √°reas
            const todasLasAreas = [...areasProtegidas, ...areasAdministrativas];
            
            let map;
            let markersLayer;
            let areaData = [];
            let activeFilters = {
                types: [],
                regions: [],
                adminTypes: [],
                search: '',
                fiasOnly: false
            };
            
            function init() {
                createAppData();
                initMap();
                createFilterOptions();
                updateMapAndList();
                initEventListeners();
                
                setTimeout(() => {
                    document.getElementById('loading-overlay').style.display = 'none';
                }, 1500);
            }
            
            function createAppData() {
                areaData = todasLasAreas.map(area => {
                    let config, iconHtml;
                    
                    if (area.esAdministrativa) {
                        config = { icon: 'fa-building', color: getAdminColor(area.subtipo) };
                        iconHtml = `<div style="font-size: 24px;"><i class="fas ${config.icon}" style="color: ${config.color};"></i></div>`;
                    } else {
                        config = areaConfig[area.tipo] || areaConfig.default;
                        const pulseClass = area.tieneBienesFIAS ? 'fias-marker-pulse' : '';
                        iconHtml = `<div class="${pulseClass}" style="font-size: 24px;"><i class="fas ${config.icon}" style="color: ${config.color};"></i></div>`;
                    }
                    
                    const customIcon = L.divIcon({ 
                        html: iconHtml, 
                        className: 'custom-map-icon', 
                        iconSize: [30, 30], 
                        iconAnchor: [15, 15], 
                        popupAnchor: [0, -15] 
                    });
                    
                    const marker = L.marker([area.latitud, area.longitud], { icon: customIcon });
                    
                    let popupContent = `<h5><i class="fas ${config.icon} me-2"></i>${area.nombre}</h5>`;
                    popupContent += `<p class="mb-0"><strong>Tipo:</strong> ${area.tipo}<br><strong>Regi√≥n:</strong> ${area.region}</p>`;
                    if (area.direccion) popupContent += `<p class="mb-0"><strong>Direcci√≥n:</strong> ${area.direccion}</p>`;
                    if (area.tieneBienesFIAS) popupContent += `<p class="text-primary fw-bold mb-0 mt-2"><i class="fas fa-gem me-1"></i> Contiene bienes institucionales</p>`;
                    
                    popupContent += `<div class="mt-2 text-center">
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewDetails(${area.id})">
                            <i class="fas fa-info-circle me-1"></i>Detalles
                        </button>
                        ${area.tieneBienesFIAS ? `
                        <button class="btn btn-sm btn-outline-success" onclick="viewInventory(${area.id})">
                            <i class="fas fa-boxes-stacked me-1"></i>Inventario
                        </button>
                        ` : ''}
                    </div>`;
                    
                    marker.bindPopup(popupContent);
                    marker.on('click', () => {
                        highlightCard(area.id);
                        const cardElement = document.querySelector(`.area-card[data-id='${area.id}']`);
                        if (cardElement) {
                            cardElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }
                    });
                    
                    return { ...area, marker, config };
                });
            }
            
            function getAdminColor(subtipo) {
                switch(subtipo) {
                    case 'FIAS': return 'var(--fias-color)';
                    case 'REM': return 'var(--rem-color)';
                    case 'FAP': return 'var(--fap-color)';
                    case 'Bioeconom√≠a': return 'var(--bio-color)';
                    case 'PASF': return 'var(--pasf-color)';
                    case 'Conserva Aves': return 'var(--conserva-color)';
                    case 'FEIG': return 'var(--feig-color)';
                    default: return 'var(--admin-color)';
                }
            }
            
            function initMap() {
                map = L.map('map').setView([-1.8312, -78.1834], 7);
                const baseLayers = {
                    "OpenStreetMap": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }),
                    "Sat√©lite": L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', { attribution: 'Tiles &copy; Esri' }),
                    "Topogr√°fico": L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', { attribution: 'Map data: &copy; OpenTopoMap' }), "CartoDB Positron": L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CartoDB'
        }),
        "CartoDB Dark Matter": L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; CartoDB'
        })
                };
                baseLayers.OpenStreetMap.addTo(map);
                L.control.layers(baseLayers).addTo(map);
                markersLayer = L.markerClusterGroup();
                map.addLayer(markersLayer);

                const legend = L.control({position: 'bottomright'});
                legend.onAdd = function(map) {
                    const div = L.DomUtil.create('div', 'legend');
                    div.innerHTML = `
                        <h4><i class="fas fa-map-signs me-1"></i> Leyenda</h4>
                        <span><i style="background: var(--primary-color)"></i> √Årea Protegida</span><br>
                        <span><i style="background: var(--admin-color)"></i> √Årea Administrativa</span><br>
                        <span><i class="fas fa-gem text-primary"></i> Con bienes institucionales</span>
                    `;
                    return div;
                };
                legend.addTo(map);
            }
            
            function createFilterOptions() {
                const types = [...new Set(areasProtegidas.map(a => a.tipo))].sort();
                const typeOptions = document.getElementById('type-options');
                types.forEach(type => typeOptions.appendChild(createFilterOption(type, areasProtegidas.filter(a => a.tipo === type).length, 'type')));

                const regions = [...new Set(areasProtegidas.map(a => a.region))].sort();
                const regionOptions = document.getElementById('region-options');
                regions.forEach(region => regionOptions.appendChild(createFilterOption(region, areasProtegidas.filter(a => a.region === region).length, 'region')));

                const adminTypes = [...new Set(areasAdministrativas.map(a => a.subtipo))].sort();
                const adminOptions = document.getElementById('admin-options');
                adminTypes.forEach(subtipo => adminOptions.appendChild(createFilterOption(subtipo, areasAdministrativas.filter(a => a.subtipo === subtipo).length, 'adminType')));
            }
            
            function createFilterOption(value, count, type) {
                const option = document.createElement('div');
                option.className = 'filter-option';
                const id = `${type}-${value.replace(/\s+/g, '-').toLowerCase()}`;
                option.innerHTML = `
                    <input type="checkbox" id="${id}" data-filter-type="${type}" data-value="${value}">
                    <label for="${id}"><span>${value}</span><span class="count">${count}</span></label>`;
                
                option.querySelector('input').addEventListener('change', function() {
                    const { filterType, value } = this.dataset;
                    let targetArray;
                    if (filterType === 'type') targetArray = activeFilters.types;
                    else if (filterType === 'region') targetArray = activeFilters.regions;
                    else targetArray = activeFilters.adminTypes;

                    if (this.checked) {
                        if (!targetArray.includes(value)) targetArray.push(value);
                    } else {
                        const index = targetArray.indexOf(value);
                        if (index > -1) targetArray.splice(index, 1);
                    }
                    updateSelectedCounts();
                    updateMapAndList();
                });
                return option;
            }
            
            function updateSelectedCounts() {
                document.getElementById('selected-types-count').textContent = activeFilters.types.length;
                document.getElementById('selected-regions-count').textContent = activeFilters.regions.length;
                document.getElementById('selected-admin-count').textContent = activeFilters.adminTypes.length;
            }
            
            function updateMapAndList() {
                markersLayer.clearLayers();
                const areasCards = document.getElementById('areas-cards');
                areasCards.innerHTML = '';
                
                const search = document.getElementById('search-input').value.toLowerCase();
                const fiasOnly = document.getElementById('fias-filter').checked;
                
                activeFilters.search = search;
                activeFilters.fiasOnly = fiasOnly;
                
                const filteredAreas = areaData.filter(area => {
                    const searchMatch = area.nombre.toLowerCase().includes(search);
                    if (!searchMatch) return false;

                    if (area.esAdministrativa) {
                        if (fiasOnly) return true;
                        return activeFilters.adminTypes.length === 0 || activeFilters.adminTypes.includes(area.subtipo);
                    } else {
                        if (fiasOnly && !area.tieneBienesFIAS) return false;
                        const typeMatch = activeFilters.types.length === 0 || activeFilters.types.includes(area.tipo);
                        const regionMatch = activeFilters.regions.length === 0 || activeFilters.regions.includes(area.region);
                        return typeMatch && regionMatch;
                    }
                });
                
                filteredAreas.forEach(area => {
                    markersLayer.addLayer(area.marker);
                    const card = document.createElement('div');
                    card.className = `area-card ${area.esAdministrativa ? 'admin-card' : ''}`;
                    card.dataset.id = area.id;
                    
                    let colorClass = '';
                    if (area.esAdministrativa) {
                        colorClass = `${area.subtipo.toLowerCase().replace(/\s/g, '-')}-color`;
                    }
                    
                    const fiasBadge = area.tieneBienesFIAS ? '<span class="badge fias-badge ms-2"><i class="fas fa-gem me-1"></i>FIAS</span>' : '';
                    
                    card.innerHTML = `
                        <div class="area-card-header">
                            <div><i class="fas ${area.config.icon} area-card-icon ${colorClass}"></i><strong>${area.nombre}</strong>${fiasBadge}</div>
                        </div>
                        <div class="area-card-body">
                            <div class="d-flex justify-content-between">
                                <span class="badge bg-light text-dark">${area.tipo}</span>
                                <span class="badge bg-light text-dark">${area.region}</span>
                            </div>
                            ${area.direccion ? `<p class="mt-2 mb-0 small text-muted"><i class="fas fa-map-marker-alt me-1"></i>${area.direccion}</p>` : ''}
                            <div class="mt-2">
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="viewDetails(${area.id})" data-bs-toggle="tooltip" title="Ver detalles"><i class="fas fa-info-circle"></i></button>
                                ${area.tieneBienesFIAS ? `<button class="btn btn-sm btn-outline-success" onclick="viewInventory(${area.id})" data-bs-toggle="tooltip" title="Abrir inventario"><i class="fas fa-boxes-stacked"></i></button>` : ''}
                            </div>
                        </div>`;
                    
                    card.addEventListener('click', () => {
                        highlightCard(area.id);
                        area.marker.openPopup();
                        map.setView([area.latitud, area.longitud], 10);
                        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                    areasCards.appendChild(card);
                });
                
                document.getElementById('visible-count').textContent = filteredAreas.length;
                document.getElementById('total-count').textContent = areaData.length;
                document.getElementById('areas-count').textContent = `${filteredAreas.length}/${areaData.length}`;
                
                updateFilterCheckboxes();
                initializeTooltips();
            }
            
            function updateFilterCheckboxes() {
                document.querySelectorAll('.filter-option input').forEach(checkbox => {
                    const { filterType, value } = checkbox.dataset;
                    let isChecked = false;
                    if (filterType === 'type') isChecked = activeFilters.types.includes(value);
                    else if (filterType === 'region') isChecked = activeFilters.regions.includes(value);
                    else if (filterType === 'adminType') isChecked = activeFilters.adminTypes.includes(value);
                    checkbox.checked = isChecked;
                });
                updateSelectedCounts();
            }
            
            function highlightCard(id) {
                document.querySelectorAll('.area-card').forEach(card => card.classList.remove('active'));
                const selectedCard = document.querySelector(`.area-card[data-id='${id}']`);
                if (selectedCard) selectedCard.classList.add('active');
            }
            
            function resetFilters() {
                activeFilters = { types: [], regions: [], adminTypes: [], search: '', fiasOnly: false };
                document.getElementById('search-input').value = '';
                document.getElementById('fias-filter').checked = false;
                updateMapAndList();
                Swal.fire({ title: 'Filtros reiniciados', icon: 'success', confirmButtonText: 'Aceptar', confirmButtonColor: 'var(--primary-color)' });
            }
            
            function initEventListeners() {
                document.getElementById('search-input').addEventListener('input', updateMapAndList);
                document.getElementById('fias-filter').addEventListener('change', updateMapAndList);
                document.getElementById('reset-filters').addEventListener('click', resetFilters);
                document.getElementById('scroll-to-top').addEventListener('click', () => document.querySelector('.sidebar-content').scrollTo({ top: 0, behavior: 'smooth' }));
                
                const setupFilterActions = (type) => {
                    document.getElementById(`select-all-${type}s`).addEventListener('click', () => {
                        activeFilters[`${type}s`] = [...new Set( (type === 'admin' ? areasAdministrativas.map(a => a.subtipo) : areasProtegidas.map(a => a[type])) )];
                        updateMapAndList();
                    });
                    document.getElementById(`clear-all-${type}s`).addEventListener('click', () => {
                        activeFilters[`${type}s`] = [];
                        updateMapAndList();
                    });
                };
                setupFilterActions('type');
                setupFilterActions('region');
                document.getElementById('select-all-admin').addEventListener('click', () => {
                    activeFilters.adminTypes = [...new Set(areasAdministrativas.map(a => a.subtipo))];
                    updateMapAndList();
                });
                document.getElementById('clear-all-admin').addEventListener('click', () => {
                    activeFilters.adminTypes = [];
                    updateMapAndList();
                });
                
                document.getElementById('toggle-sidebar-btn').addEventListener('click', function() {
                    document.getElementById('sidebar').classList.toggle('collapsed');
                    this.querySelector('i').classList.toggle('fa-bars');
                    this.querySelector('i').classList.toggle('fa-chevron-right');
                });
            }

            window.viewInventory = function(id) {
                const area = areaData.find(a => a.id === id);
                if (area && area.tieneBienesFIAS) {
                    if (area.link && area.link !== 'URL_AQUI') {
                        Swal.fire({
                            title: `Inventario de ${area.nombre}`,
                            html: `Ser√° redirigido al inventario de bienes institucionales. ¬øDesea continuar?`,
                            icon: 'info',
                            showCancelButton: true,
                            confirmButtonText: '<i class="fas fa-external-link-alt me-1"></i> Abrir enlace',
                            cancelButtonText: 'Cancelar',
                            confirmButtonColor: 'var(--primary-color)'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                window.open(area.link, '_blank');
                            }
                        });
                    } else {
                        Swal.fire({
                            title: 'Inventario FIAS',
                            html: `El enlace al inventario para <strong>${area.nombre}</strong> a√∫n no ha sido configurado.`,
                            icon: 'warning',
                            confirmButtonText: 'Entendido',
                            confirmButtonColor: 'var(--primary-color)'
                        });
                    }
                }
            };

            window.viewDetails = function(id) {
                const area = areaData.find(a => a.id === id);
                if (area) {
                    let content = `<div class="text-start">
                        <strong>Tipo:</strong> ${area.tipo}<br>
                        <strong>Regi√≥n:</strong> ${area.region}<br>
                        <strong>Coordenadas:</strong> ${area.latitud.toFixed(4)}, ${area.longitud.toFixed(4)}`;
                    if (area.direccion) content += `<br><strong>Direcci√≥n:</strong> ${area.direccion}`;
                    if (area.tieneBienesFIAS) content += `<br><br><span class="text-primary"><i class="fas fa-gem me-1"></i> Contiene bienes institucionales.</span>`;
                    content += `</div>`;
                    
                    Swal.fire({
                        title: area.nombre,
                        html: content,
                        icon: 'info',
                        confirmButtonText: 'Cerrar',
                        confirmButtonColor: 'var(--primary-color)'
                    });
                }
            };
            
            function initializeTooltips() {
                const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
            }

            init();
            initializeTooltips();
        });
    </script>
</body>
</html>
